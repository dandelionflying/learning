## ES

#### es 写入数据的工作原理是什么啊？es 查询数据的工作原理是什么啊？底层的 lucene 介绍一下？倒排索引了解吗？

es引入分片的概念，一个索引被分成多个分片，每个分片都有一个主分片和多个副本，每个副本都是具有完整功能的Lucene实例。分片可以分配在不同的服务器上，同一个分片的不同副本不能分配在相同的服务器上。

**写操作时**，请求先经过协调节点，通过哈希计算出文档要分配到的分片，找到对应的分片写入主分片，并同步到它所有服务器上的副本。副本写入后返回给主分片，最后返回给协调节点告知写入成功。

<img src="pictures\es-写过程.png">

**读操作时会**通过哈希计算定位分配，再通过负载均衡策略，选择主分片或者某个副本拿到数据返回。



#### 倒排索引

倒排索引就是通过value去找key。es中每个文档都有一个对应的文档id，文档内容被表示为一系列关键词的集合。倒排索引就是关键词到文档id的映射，同时也记录了单词在文档中出现的频率、位置和偏移（起始位置）。

倒排索引由**单词词典**、**倒排列表**、**倒排文件**组成



es的大致流程就是，根据分词器将文档拆分，形成倒排索引

-->根据搜索的关键词查找倒排索引找到对应的文档id

-->拿到文档id再去正排索引查找完整内容



## mongodb





## clickhouse