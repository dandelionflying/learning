#### 28.为什么用redis？为什么是redis？

提升并发访问性能。

相对于memcached，支持更多的数据类型。

redis可以将数据持久化，就是说可以把内存中的数据存到磁盘中，重启时可读取磁盘的数据。memcached不支持。

#### 29.redis数据类型有哪些？分别在哪些场景下使用比较合适？

String，Hash，List（双向链表），Set，Sorted Set

#### 30.redis常用指令？

set、get、hget、hset、lpush、rpush、lpop、rpop、lrange（可用于分页）

#### 31.如何设计redis的过期策略？

redis内存淘汰机制

针对已设置过期时间的数据集有几个策略：

volatile-LRU：最近最少使用原则

volatile-TTL：即将要过期的

volatile-Random：任意选择淘汰

……

#### 32.redis如何做持久化？如何选择？

RDB（快照）：默认的持久化方式，复制快照到其他服务器。容灾性好。

AOF（追加文件）：讲执行的写命令写到AOF文件末尾，以此来记录数据发生的变化。数据恢复时，需要重新执行一次AOF文件所有的写命令。（**主从复制可以用**）

开启方式 `appendonly yes`

可设置的追加策略有三种：always每次写操作、everysec每秒钟、no让操作系统决定。一般选择**everysec**

AOF方式保存的数据的完整性要高于RDB方式。如果需要备份数据有较高的数据完整性那么选择AOF。并设置每秒同步一次。

#### 33.说一下缓存雪崩

缓存大面积失效，导致瞬间有大量请求打到数据库上，数据库承受不住崩掉了

- 处理方法：
  - 事前：
    - 尽量保证缓存的高可用，集群啊，内存淘汰机制啊之类的。
    - 缓存过期时间随机设置，避免同一时间大量过期。
    - 缓存预热（系统启动时）
    - 互斥锁。同一时刻只让一个通过。这样请求结束后，缓存就有了，后面来的直接用。
  - 事中：也就是当缓存大面积失效时，打到请求量会激增，故要做好降级措施，比如有百分之40的请求会通过走向数据库，另外的百分之60的请求被降级，返回默认数据（提示语，空数据啥的）。
  - 事后：备份恢复，尽快根据redis的持久化数据恢复。

#### 说一下缓存穿透

缓存和数据库都没有数据，导致请求不停打到数据库层。

解决：

- 接口层多进行校验拦截
- 没有数据则redis给一个值为null的，并设置较短的过期时间（避免期间数据库产生实际数据，而redis依然为空）
- 布隆过滤器。将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被这个bitmap拦截掉（有哈希碰撞问题，但主要是为了判断哈希有无，无则一定会被拦截掉）。

#### 说一下缓存穿透

缓存没有。数据库有。同一时刻可能会有大量请求走向这个缓存，最后都打到数据库层。

与缓存雪崩不同的是，**缓存击穿指并发查同一条数据，雪崩是不同数据都过期了导致大面积请求压向db**

解决：

- 热点数据永不过期
- 互斥锁



#### 77.redis有哪些功能？

数据缓存

分布式锁

消息队列

数据持久化

#### 79.redis几个数据类型的应用场景

- String：可以是字符串、证书或者浮点数。
  - 可以对字符串或其一部分操作；对证书和浮点数进行自增或自减.
  - incr，decr，append，
  - 商品库存，计数器等
- hash：包含键值对的无需散列表。
  - 可以添加、获取、移除单个键值对；获取所有键值对
  - 对象信息（文章详情、商品详情等），登录信息等
- list：双向链表，链表中存储字符串。
  - 可以从链表两端插入或移出。根据偏移量对链表进行过修剪。读取单个或多个元素。根据值查找或移出。
  - l/rpush。r/rpop。lrange：用于获取列表在给定范围上的所有元素。Lindex：获取某个列表特定索引的元素。
  - 关注列表等
- Set：包含字符串的无序集合，并且不可重复。
  - 可以添加、获取、移除单个元素。检查一个元素是否存在于集合中。计算交集、并集、差集。随机获取元素。
  - 含唯一性的数据列表。文章列表、分组等。
- ZSET：有序集合。字符串成员与浮点数分值之间的有序映射，元素的排列与分值大小有关。
  - zadd key 123 value1。zrange：根据索引范围获取多个元素。ZREM：移出
  - 需要排序的，比如文章列表需要根据点赞数/浏览次数/创建时间等进行排序，就可以利用ZSET，分别以点赞数/浏览次数/创建时间为score分值。

#### 主从复制

redis虽然快，但也不是完全可靠，单机的redis也有并发承载上线。这时候单机就不够了。

主从复制流程：

<img src="pictures\redis主从复制流程.png">

#### 主从链

